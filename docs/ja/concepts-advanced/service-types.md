# サービスタイプ

以下に示すのは、[`docker-compose.yml` ファイル](../concepts-basics/docker-compose-yml.md)内の `lagoon.type` を通じて定義できるすべてのサービスタイプです。

!!! Warning "警告"
    一度 `lagoon.type` が定義され、環境がデプロイされると、異なるタイプに変更することはサポートされておらず、環境が壊れる可能性があります。

## `basic`

基本的なコンテナで、既存のテンプレートがないアプリケーションのほとんどに適しています。永続的なストレージはありません。ポートはラベルを使用して変更できます。[自動生成されたルート](../concepts-basics/docker-compose-yml.md#auto-generated-routes)が必要でない場合(例:内部向けサービスの場合)、docker-compose.yml 内で `lagoon.autogeneratedroute: false` を設定します。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `3000`でTCP接続 | `3000` | はい | いいえ | `lagoon.service.port`, `lagoon.autogeneratedroute` |

## `basic-persistent`

`basic`と同じですが、**永続的なストレージを生成し**、`lagoon.persistent` をでマウントの位値を定義します。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | --- | :--- | :--- | :--- |
| `3000`でTCP接続 | `3000` | はい | はい |  `lagoon.service.port`, `lagoon.autogeneratedroute`, `lagoon.persistent`, `lagoon.persistent.name`, `lagoon.persistent.size`, `lagoon.persistent.class` |

## `cli`

PHP、Node.jsなど、任意のCLIコンテナに使用します。 `/var/run/secrets/lagoon/sshkey/ssh-privatekey`にマウントされている顧客のSSHプライベートキーが自動的に取得されます。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | その他のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| - | いいえ | いいえ | いいえ | - |

## `cli-persistent`

`cli`と同じですが、`lagoon.persistent.name`は永続ストレージを持つサービスの名前を指定されることを期待しています。これは定義された`lagoon.persistent`ラベルの下にマウントされます。自身の永続ストレージを生成せず、別のサービスの永続ストレージをマウントするためだけに使用されます。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | その他のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| - | いいえ | いいえ | はい | `lagoon.persistent.name`, `lagoon.persistent` |

## `elasticsearch`

Elasticsearchコンテナは、`/usr/share/el`の下に永続ストレージを自動生成します。 `elasticsearch/data`

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `localhost:9200/_cluster/health?local=true` でHTTP通信 | 9200 | なし | はい | `lagoon.persistent.size` |

## `kibana`

Kibanaコンテナ。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `5601`でTCP接続 | `5601` | はい | なし | - |

## `logstash`

Logstashコンテナ。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `9600`でTCP接続 | `9600` | なし | なし | - |

## `mariadb`

Lagoonに`mariadb-single`と`mariadb-dbaas`のどちらかを自動的に決定させるメタサービス。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| - | - | - | - | - |

## `mariadb-single`

MariaDBコンテナ。`/lagoon/mysql-backup.sh 127.0.0.1`を実行するバックアップのcronジョブを24時間ごとに作成します。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `3306`でTCP接続 | `3306` | なし | はい | `lagoon.persistent.size` |

## `mariadb-dbaas`

DBaaSオペレーターを介した共有MariaDBサーバーを使用します。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| 不要 | `3306` | なし | - | - |

## `mongodb`

Lagoonに`mongodb-single`と`mongodb-dbaas`のどちらかを自動的に決定させるメタサービス。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| - | - | - | - | - |

## `mongodb-single`

MongoDBコンテナ、`/data/db`にマウントされた最小1GBの永続ストレージを生成します。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `27017`でTCP接続 | `27017` | なし | はい | `lagoon.persistent.size` |

## `mongodb-dbaas`

DBaaSオペレーターを介した共有MongoDBサーバーを使用します。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| 不要 | `27017` | いいえ | - | - |

## `nginx`

NGINXコンテナ。永続的なストレージはありません。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加カスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `localhost:50000/nginx_status` | `8080` | はい | いいえ | `lagoon.autogeneratedroute` |

## `nginx-php`

`nginx`と同じですが、追加で`php`コンテナがあります。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加カスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| NGINX: `localhost:50000/nginx_status`, PHP: `/usr/sbin/check_fcgi` | `8080` | はい | いいえ | `lagoon.autogeneratedroute` |

## `nginx-php-persistent`

`nginx-php`と同様。永続的なストレージを生成し、`lagoon.persistent` でマウントの位置を定義します。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加カスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| NGINX: `localhost:50000/nginx_status`, PHP: `/usr/sbin/check_fcgi` | httpの`8080` | はい | はい | `lagoon.autogeneratedroute`, `lagoon.persistent`, `lagoon.persistent.name`, `lagoon.persistent.size`, `lagoon.persistent.class` |

## `node`

Node.js コンテナ。永続的なストレージはありません。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `3000`でTCP接続 | `3000` | はい | なし | `lagoon.autogeneratedroute` |

## `node-persistent`

`node`と同様。永続的なストレージを生成し、`lagoon.persistent`でマウントの位置を定義します。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `3000`でTCP接続 | `3000` | はい | はい | `lagoon.autogeneratedroute`, `lagoon.persistent`, `lagoon.persistent.name`, `lagoon.persistent.size`, `lagoon.persistent.class` |

## `none`

Lagoonにこのサービスを完全に無視するよう指示します。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| - | - | - | - | - |

## `opensearch`

OpenSearchコンテナ、`/usr/share/opensearch/data`以下に永続的なストレージを自動生成します。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `localhost:920`でのHTTP 0/_cluster/health?local=true` | 9200 | いいえ | はい | `lagoon.persistent.size` |

## `postgres`

Lagoonに`postgres-single`と`postgres-dbaas`のどちらかを自動的に決定に決定させるメタサービス。

| 健康チェック | 露出ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| - | - | - | - | - |

## `postgres-single`

Postgresコンテナ。バックアップ用のcronジョブを作成し、24時間ごとに`/lagoon/postgres-backup.sh localhost`を実行します。

| 健康チェック | 露出ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `5432`でTCP接続 | `5432` | いいえ | はい | `lagoon.persistent.size` |

## `postgres-dbaas`

DBaaS Operator経由で共有PostgreSQLサーバを利用します。

| 健康チェック | 露出ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| 不要 | `5432` | いいえ | - | - |

## `python`

Pythonコンテナ。永続ストレージはありません。

| 健康チェック | 露出ポート | 自動生成ルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `8800`でHTTP接続 | `8800` | はい | いいえ | `lagoon.autogeneratedroute` |

## `python-persistent`

永続ストレージを備えたPythonコンテナ。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加カスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `8800`でHTTP接続 | `8800` | はい | はい | `lagoon.autogeneratedroute` |

## `redis`

Redisコンテナ。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加カスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `6379`でTCP接続 | `6379` | いいえ | いいえ | - |

## `redis-persistent`

`/data`以下にマウントされた自動生成の永続ストレージを備えたRedisコンテナ。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加カスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `6379`でTCP接続 | `6379` | いいえ | はい | `lagoon.persistent.size` |

## `solr`

`/var/solr`以下にマウントされた自動生成の永続ストレージを備えたSolrコンテナ。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | 追加カスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| `8983`でTCP接続 | `8983` | いいえ | はい | `lagoon.persistent.size` |

## `varnish`

Varnishコンテナ。

| ヘルスチェック | 公開ポート | 自動生成されたルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| HTTPリクエスト `localhost:8080/varnish_status` | `8080` | はい | いいえ | `lagoon.autogeneratedroute` |

## `varnish-persistent`

`/var/cache/varnish` 下にマウントされた自動生成される永続的なストレージを持つVarnishコンテナ。

| ヘルスチェック | 公開ポート | 自動生成されたルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| HTTPリクエスト `localhost:8080/varnish_status` | `8080` | はい | はい | `lagoon.autogeneratedroute`, `lagoon.persistent.size` |

## `worker`

任意の種類のワーカーコンテナ(キューワーカーなど)で、公開サービスポートがない場合に使用します。

| ヘルスチェック | 公開ポート | 自動生成されたルート | ストレージ | 追加のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| - | いいえ | いいえ | いいえ | - |

## `worker-persistent`

`worker`と同じですが、`lagoon.persistent.name`が永続的なストレージを持つサービスの名前を与えられることを期待し、定義された`lagoon.persistent`ラベルの下にマウントされます。このサービスは自身の永続的なストレージを生成することなく、他のサービスの永続的なストレージをマウントするためにのみ使用されます。

| ヘルスチェック | 公開ポート | 自動生成ルート | ストレージ | その他のカスタマイズパラメータ |
| :--- | :--- | :--- | :--- | :--- |
| - | いいえ | いいえ | はい | `lagoon.persistent.name`, `lagoon.persistent` |
